"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,callBackDeadSession:function(){},callBackError:function(){},context:{lang:"fr_FR"},interceptors:[]},this.$get=["$http","$cookies","$rootScope","$q","$timeout",function(e,t,n,o,s){var i=this.odooRpc;return i.sendRequest=function(n,s){var r=o.defer();s.session_id=t.session_id,i.uniq_id_counter+=1;var a={jsonrpc:"2.0",method:"call",params:s},c={method:"POST",url:i.odoo_server+n,data:JSON.stringify(a),headers:{"Content-Type":"application/json"},id:"r"+i.uniq_id_counter};return e(c).success(function(n){if("undefined"!=typeof n.error){var o=n.error,s={title:"",message:"",fullTrace:o};if(300===o.code&&o.data&&"client_exception"==o.data.type&&o.data.debug.match("SessionExpiredException"))console.log("session exipre with ",t.session_id),delete t.session_id,s.title="session_expired";else{var a=(""+o.data.fault_code).split("\n")[0].split(" -- ");a.length>1&&(o.type=a.shift(),o.data.fault_code=o.data.fault_code.substr(o.type.length+4)),200===o.code&&o.type?(s.title=o.type,s.message=o.data.fault_code.replace(/\n/g,"<br />")):(s.title=o.message,s.message=o.data.debug.replace(/\n/g,"<br />"))}r.reject(s),i.interceptors.forEach(function(e){e(s)})}else{var c=n.result;"ir.actions.act_proxy"===c.type&&angular.forEach(c.action_list,function(t){var n={method:"POST",url:i.odoo_server+t.url,data:JSON.stringify(t.params),headers:{"Content-Type":"application/json"}};e(n)}),r.resolve(c)}}).error(function(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};i.interceptors.forEach(function(e){e(t)}),r.reject(t)}),r.promise},i.login=function(e,n,s){var r=o.defer(),a={db:e,login:n,password:s};return i.sendRequest("/web/session/authenticate",a).then(function(e){e.uid?(t.session_id=e.session_id,r.resolve(e),console.log(e),i.context=e.user_context):(delete t.session_id,r.reject(e))},function(e){r.reject(e)}),r.promise},i.isLoggedIn=function(){return t.session_id&&t.session_id.length>10},i.logout=function(){delete t.session_id},i.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return i.sendRequest("/web/dataset/search_read",o)},i.call=function(e,t,n,o){o||(o={}),o.context?o.context.extend(OdooRpc.context):o.context=i.context;var s={model:e,method:t,args:n,kwargs:o};return i.sendRequest("/web/dataset/call_kw",s)},i.get_session_info=function(){return i.sendRequest("/web/session/get_session_info",{})},i.syncDataImport=function(e,t,n,o,s){return i.call(e,"get_sync_data",[t,s.timekey,n,o],{}).then(function(r){s.timekey!==r.timekey&&(s.timekey=r.timekey,$.isEmptyObject(r.data)||angular.extend(s.data,r.data),$.isEmptyObject(s.remove_ids)||angular.forEach(s.remove_ids,function(e){delete s.data[e]}),r.data.length&&i.syncDatresaImport(e,t,n,o,s))})},i.syncImportObject=function(e){function t(){return console.log("sync",e.interval),i.syncDataImport(e.model,e.func_key,e.domain,e.limit,o).then(function(){n||s(t,e.interval)})}var n=!1,o={data:{},timekey:void 0,stopCallback:function(){n=!0}};return t(),o},i}]});