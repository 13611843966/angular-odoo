"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,callBackDeadSession:function(){},callBackError:function(){},context:{lang:"fr_FR"}},this.$get=["$http","$cookies","$rootScope","$q",function(e,t,o,n){var s=this.odooRpc;return s.sendRequest=function(r,a){var i=n.defer();a.session_id=t.session_id,s.uniq_id_counter+=1;var c={jsonrpc:"2.0",method:"call",params:a},d={method:"POST",url:s.odoo_server+r,data:JSON.stringify(c),headers:{"Content-Type":"application/json"},id:"r"+s.uniq_id_counter};return e(d).success(function(n){if("undefined"!=typeof n.error){var r=n.error;if(300===r.code&&r.data&&"client_exception"==r.data.type&&r.data.debug.match("SessionExpiredException"))delete t.session_id,i.reject("session_expired");else{var a=(""+r.data.fault_code).split("\n")[0].split(" -- ");a.length>1&&(r.type=a.shift(),r.data.fault_code=r.data.fault_code.substr(r.type.length+4));var c=void 0,d=void 0;200===r.code&&r.type?(d=r.type,c=r.data.fault_code.replace(/\n/g,"<br />")):(d=r.message,c=r.data.debug.replace(/\n/g,"<br />")),o.modal({title:d,show:!0,content:c,html:!0}),i.reject({title:d,message:c,fullTrace:r})}}else{var u=n.result;"ir.actions.act_proxy"===u.type&&angular.forEach(u.action_list,function(t){var o={method:"POST",url:s.odoo_server+t.url,data:JSON.stringify(t.params),headers:{"Content-Type":"application/json"}};e(o)}),i.resolve(u)}}),i.promise},s.login=function(e,o,n){var r=$.Deferred(),a={db:e,login:o,password:n};return s.sendRequest("/web/session/authenticate",a).then(function(e){e.uid?(t.session_id=e.session_id,r.resolve(e),console.log(e),s.context=e.user_context):(delete t.session_id,r.reject(e))},function(){r.reject(error)}),r.promise()},s.logout=function(){delete t.session_id},s.searchRead=function(e,t,o){var n={model:e,domain:t,fields:o};return s.sendRequest("/web/dataset/search_read",n)},s.call=function(e,t,o,n){n||(n={}),n.context?n.context.extend(OdooRpc.context):n.context=s.context;var r={model:e,method:t,args:o,kwargs:n};return s.sendRequest("/web/dataset/call_kw",r)},s.get_session_info=function(){return s.sendRequest("/web/session/get_session_info",{})},s.syncDataImport=function(e,t,n,r){return s.call(e,"get_sync_data",[t,o.timekey,n,r],{}).then(function(a){var i=a[0];o.timekey=a[1];var c=a[2];$.isEmptyObject(i)||(angular.extend(o.items,i),s.syncDataImport(e,t,n,r)),$.isEmptyObject(c)||angular.forEach(c,function(e){delete o.items[e]})})},s}]});