"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,context:{lang:"fr_FR"},shouldManageSessionId:!1,errorInterceptors:[]};var e=null;this.$get=["$http","$q","$timeout",function(n,o,r){var s=this.odooRpc;return s.login=function(e,n,r){var i={db:e,login:n,password:r};return s.sendRequest("/web/session/authenticate",i).then(function(e){return e.uid?(s.context=e.user_context,t.set_sessionId(e.session_id),e):(t.delete_sessionId(),o.reject({title:"wrong_login",message:"Credentials incorrect",fullTrace:e}))})},s.isLoggedIn=function(e){return e?s.getSessionInfo().then(function(e){return!!e.uid}):t.get_sessionId().length>0},s.logout=function(e){t.delete_sessionId(),e&&s.getSessionInfo().then(function(e){e.db&&s.login(e.db,"","")})},s.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return s.sendRequest("/web/dataset/search_read",o)},s.getSessionInfo=function(){return s.sendRequest("/web/session/get_session_info",{})},s.getServerInfo=function(){return s.sendRequest("/web/webclient/version_info",{})},s.syncDataImport=function(e,t,n,o,r){return s.call(e,"get_sync_data",[t,r.timekey,n,o],{}).then(function(i){return r.timekey=i.timekey,angular.forEach(i.remove_ids,function(e){delete r.data[e]}),Object.keys(i.data).length?(angular.extend(r.data,i.data),s.syncDataImport(e,t,n,o,r)):void 0})},s.syncImportObject=function(e){function t(){s.syncDataImport(e.model,e.func_key,e.domain,e.limit,i).then(function(){n||r(t,e.interval)}).then(function(){o.forEach(function(e){e(i)})})}var n=!1,o=[],i={data:{},timekey:null,stopCallback:function(){n=!0},watch:function(e){o.push(e)}};return t(),i},s.call=function(e,t,n,o){o=o||{},o.context=o.context||{},angular.extend(o.context,s.context);var r={model:e,method:t,args:n,kwargs:o};return s.sendRequest("/web/dataset/call_kw",r)},s.sendRequest=function(r,i){function a(e,n){s.uniq_id_counter+=1,s.shouldManageSessionId&&(n.session_id=t.get_sessionId());var o={jsonrpc:"2.0",method:"call",params:n};return{method:"POST",url:s.odoo_server+e,data:JSON.stringify(o),headers:{"Content-Type":"application/json"},id:"r"+s.uniq_id_counter}}function u(e){if(!e.data.error)return e.data;var n=e.data.error,r={title:"",message:"",fullTrace:n};if(200===n.code&&"Odoo Server Error"===n.message&&"werkzeug.exceptions.NotFound"===n.data.name)r.title="page_not_found",r.message="HTTP Error";else if(100===n.code&&"Odoo Session Expired"===n.message||300===n.code&&"OpenERP WebClient Error"===n.message&&n.data.debug.match("SessionExpiredException"))r.title="session_expired",t.delete_sessionId();else{var i=(""+n.data.fault_code).split("\n")[0].split(" -- ");i.length>1&&(n.type=i.shift(),n.data.fault_code=n.data.fault_code.substr(n.type.length+4)),200===n.code&&n.type?(r.title=n.type,r.message=n.data.fault_code.replace(/\n/g,"<br />")):(r.title=n.message,r.message=n.data.debug.replace(/\n/g,"<br />"))}return s.errorInterceptors.forEach(function(e){e(r)}),o.reject(r)}function c(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};return s.errorInterceptors.forEach(function(e){e(t)}),o.reject(t)}function d(e,t){var o=a(e,t);return n(o).then(u,c)}function l(){return e||d("/web/webclient/version_info",{}).then(function(t){s.shouldManageSessionId=t.result.server_serie<"8",e=o.when()})}return l().then(function(){return d(r,i).then(function(e){var t=[];return"ir.actions.act_proxy"===e.result.type?(angular.forEach(e.result.action_list,function(e){t.push(n.post(e.url,e.params))}),o.all(t)):e.result})})},s}];var t=function(){return{delete_sessionId:function(){document.cookie="session_id=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},get_sessionId:function(){return document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*session_id\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},set_sessionId:function(e){document.cookie="session_id="+e}}}()});