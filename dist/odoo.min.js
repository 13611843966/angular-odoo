"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,callBackDeadSession:function(){},callBackError:function(){},context:{lang:"fr_FR"}},this.$get=["$http","$cookies","$rootScope","$q","$interval",function(e,t,n,o,s){var r=this.odooRpc;return r.sendRequest=function(s,a){var i=o.defer();a.session_id=t.session_id,r.uniq_id_counter+=1;var c={jsonrpc:"2.0",method:"call",params:a},d={method:"POST",url:r.odoo_server+s,data:JSON.stringify(c),headers:{"Content-Type":"application/json"},id:"r"+r.uniq_id_counter};return e(d).success(function(o){if("undefined"!=typeof o.error){var s=o.error;if(300===s.code&&s.data&&"client_exception"==s.data.type&&s.data.debug.match("SessionExpiredException"))delete t.session_id,i.reject("session_expired");else{var a=(""+s.data.fault_code).split("\n")[0].split(" -- ");a.length>1&&(s.type=a.shift(),s.data.fault_code=s.data.fault_code.substr(s.type.length+4));var c=void 0,d=void 0;200===s.code&&s.type?(d=s.type,c=s.data.fault_code.replace(/\n/g,"<br />")):(d=s.message,c=s.data.debug.replace(/\n/g,"<br />")),n.modal({title:d,show:!0,content:c,html:!0}),i.reject({title:d,message:c,fullTrace:s})}}else{var u=o.result;"ir.actions.act_proxy"===u.type&&angular.forEach(u.action_list,function(t){var n={method:"POST",url:r.odoo_server+t.url,data:JSON.stringify(t.params),headers:{"Content-Type":"application/json"}};e(n)}),i.resolve(u)}}),i.promise},r.login=function(e,n,o){var s=$.Deferred(),a={db:e,login:n,password:o};return r.sendRequest("/web/session/authenticate",a).then(function(e){e.uid?(t.session_id=e.session_id,s.resolve(e),console.log(e),r.context=e.user_context):(delete t.session_id,s.reject(e))},function(){s.reject(error)}),s.promise()},r.isLoggedIn=function(){return t.session_id&&t.session_id.length>10},r.logout=function(){delete t.session_id},r.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return r.sendRequest("/web/dataset/search_read",o)},r.call=function(e,t,n,o){o||(o={}),o.context?o.context.extend(OdooRpc.context):o.context=r.context;var s={model:e,method:t,args:n,kwargs:o};return r.sendRequest("/web/dataset/call_kw",s)},r.get_session_info=function(){return r.sendRequest("/web/session/get_session_info",{})},r.syncDataImport=function(e,t,n,o,s){return r.call(e,"get_sync_data",[t,s.timekey,n,o],{}).then(function(a){var i=a[0];s.timekey=a[1];var c=a[2];$.isEmptyObject(i)||(angular.extend(s.data,i),r.syncDataImport(e,t,n,o,s)),$.isEmptyObject(c)||angular.forEach(c,function(e){delete s.data[e]})})},r.syncImportObject=function(e){var t={data:{},timekey:null},n=function(){r.syncDataImport(e.model,e.func_key,e.domain,e.limit,t)};return s(n,e.interval),t},r}]});