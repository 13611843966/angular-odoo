"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,context:{lang:"fr_FR"},shouldManageSessionId:!1,errorInterceptors:[]};var e=null;this.$get=["$http","$q","$timeout",function(n,o,s){var r=this.odooRpc;return r.login=function(e,n,s){var i={db:e,login:n,password:s};return r.sendRequest("/web/session/authenticate",i).then(function(e){return e.uid?(r.context=e.user_context,t.set_sessionId(e.session_id),e):(t.delete_sessionId(),o.reject({title:"wrong_login",message:"Credentials incorrect",fullTrace:e}))})},r.isLoggedIn=function(e){return e?r.getSessionInfo().then(function(e){return!!e.uid}):t.get_sessionId().length>0},r.logout=function(e){t.delete_sessionId(),e&&r.getSessionInfo().then(function(e){e.db&&r.login(e.db,"","")})},r.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return r.sendRequest("/web/dataset/search_read",o)},r.getSessionInfo=function(){return r.sendRequest("/web/session/get_session_info",{})},r.getServerInfo=function(){return r.sendRequest("/web/webclient/version_info",{})},r.syncDataImport=function(e,t,n,o,s){return r.call(e,"get_sync_data",[t,s.timekey,n,o],{}).then(function(i){s.timekey=i.timekey,angular.forEach(i.remove_ids,function(e){delete s.data[e]}),Object.keys(i.data).length&&(angular.extend(s.data,i.data),r.syncDataImport(e,t,n,o,s))})},r.syncImportObject=function(e){function t(){r.syncDataImport(e.model,e.func_key,e.domain,e.limit,i).then(function(){n||s(t,e.interval)}).then(function(){o.forEach(function(e){e(i)})})}var n=!1,o=[],i={data:{},timekey:null,stopCallback:function(){n=!0},watch:function(e){o.push(e)}};return t(),i},r.call=function(e,t,n,o){o=o||{},o.context=o.context||{},angular.extend(o.context,r.context);var s={model:e,method:t,args:n,kwargs:o};return r.sendRequest("/web/dataset/call_kw",s)},r.sendRequest=function(s,i){function a(e,n){r.uniq_id_counter+=1,r.shouldManageSessionId&&(n.session_id=t.get_sessionId());var o={jsonrpc:"2.0",method:"call",params:n};return{method:"POST",url:r.odoo_server+e,data:JSON.stringify(o),headers:{"Content-Type":"application/json"},id:"r"+r.uniq_id_counter}}function u(e){if(!e.data.error)return e.data;var n=e.data.error,s={title:"",message:"",fullTrace:n};if(200===n.code&&"Odoo Server Error"===n.message&&"werkzeug.exceptions.NotFound"===n.data.name)s.title="page_not_found",s.message="HTTP Error";else if(100===n.code&&"Odoo Session Expired"===n.message||300===n.code&&"OpenERP WebClient Error"===n.message&&n.data.debug.match("SessionExpiredException"))s.title="session_expired",t.delete_sessionId();else{var i=(""+n.data.fault_code).split("\n")[0].split(" -- ");i.length>1&&(n.type=i.shift(),n.data.fault_code=n.data.fault_code.substr(n.type.length+4)),200===n.code&&n.type?(s.title=n.type,s.message=n.data.fault_code.replace(/\n/g,"<br />")):(s.title=n.message,s.message=n.data.debug.replace(/\n/g,"<br />"))}return r.errorInterceptors.forEach(function(e){e(s)}),o.reject(s)}function c(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};return r.errorInterceptors.forEach(function(e){e(t)}),o.reject(t)}function d(e,t){var o=a(e,t);return n(o).then(u,c)}function l(){return e||d("/web/webclient/version_info",{}).then(function(t){r.shouldManageSessionId=t.result.server_serie<"8",e=o.when()})}return l().then(function(){return d(s,i).then(function(e){var t=[];return"ir.actions.act_proxy"===e.result.type?(angular.forEach(e.result.action_list,function(e){t.push(n.post(e.url,e.params))}),o.all(t)):e.result})})},r}];var t=function(){return{delete_sessionId:function(){document.cookie="session_id=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},get_sessionId:function(){return document.cookie.replace(new RegExp("(?:(?:^|.*;)\\s*session_id\\s*\\=\\s*([^;]*).*$)|^.*$"),"$1")},set_sessionId:function(e){document.cookie="session_id="+e}}}()});