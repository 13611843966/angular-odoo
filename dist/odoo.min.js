"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,callBackDeadSession:function(){},callBackError:function(){},context:{lang:"fr_FR"},interceptors:[]},this.$get=["$http","$cookies","$rootScope","$q","$interval",function(e,t,n,o,s){var r=this.odooRpc;return r.sendRequest=function(n,s){var i=o.defer();s.session_id=t.session_id,r.uniq_id_counter+=1;var a={jsonrpc:"2.0",method:"call",params:s},c={method:"POST",url:r.odoo_server+n,data:JSON.stringify(a),headers:{"Content-Type":"application/json"},id:"r"+r.uniq_id_counter};return e(c).success(function(n){if("undefined"!=typeof n.error){var o=n.error,s={title:"",message:"",fullTrace:o};if(300===o.code&&o.data&&"client_exception"==o.data.type&&o.data.debug.match("SessionExpiredException"))console.log("session exipre with ",t.session_id),delete t.session_id,s.title="session_expired";else{var a=(""+o.data.fault_code).split("\n")[0].split(" -- ");a.length>1&&(o.type=a.shift(),o.data.fault_code=o.data.fault_code.substr(o.type.length+4)),200===o.code&&o.type?(s.title=o.type,s.message=o.data.fault_code.replace(/\n/g,"<br />")):(s.title=o.message,s.message=o.data.debug.replace(/\n/g,"<br />"))}i.reject(s),r.interceptors.forEach(function(e){e(s)})}else{var c=n.result;"ir.actions.act_proxy"===c.type&&angular.forEach(c.action_list,function(t){var n={method:"POST",url:r.odoo_server+t.url,data:JSON.stringify(t.params),headers:{"Content-Type":"application/json"}};e(n)}),i.resolve(c)}}).error(function(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};r.interceptors.forEach(function(e){e(t)}),i.reject(t)}),i.promise},r.login=function(e,n,s){var i=o.defer(),a={db:e,login:n,password:s};return r.sendRequest("/web/session/authenticate",a).then(function(e){e.uid?(t.session_id=e.session_id,i.resolve(e),console.log(e),r.context=e.user_context):(delete t.session_id,i.reject(e))},function(e){i.reject(e)}),i.promise},r.isLoggedIn=function(){return t.session_id&&t.session_id.length>10},r.logout=function(){delete t.session_id},r.searchRead=function(e,t,n){var o={model:e,domain:t,fields:n};return r.sendRequest("/web/dataset/search_read",o)},r.call=function(e,t,n,o){o||(o={}),o.context?o.context.extend(OdooRpc.context):o.context=r.context;var s={model:e,method:t,args:n,kwargs:o};return r.sendRequest("/web/dataset/call_kw",s)},r.get_session_info=function(){return r.sendRequest("/web/session/get_session_info",{})},r.syncDataImport=function(e,t,n,o,s){return r.call(e,"get_sync_data",[t,s.timekey,n,o],{}).then(function(i){var a=i[0];if(s.timekey===i[1]){s.timekey=i[1];var c=i[2];$.isEmptyObject(a)||(a.forEach(function(){}),angular.extend(s.data,a)),$.isEmptyObject(c)||angular.forEach(c,function(e){delete s.data[e]}),a.lenght&&r.syncDataImport(e,t,n,o,s)}})},r.syncImportObject=function(e){function t(){return console.log("sync",e.interval),r.syncDataImport(e.model,e.func_key,e.domain,e.limit,n)}var n={data:{},timekey:null};return t().then(function(){var n;n=s(function(){t().then(null,function(e){console.log("stop interval",e),s.cancel(n)})},e.interval)},function(){console.log("stop because error")}),n},r}]});