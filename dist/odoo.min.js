"use strict";angular.module("odoo",[]);
"use strict";angular.module("odoo").provider("jsonRpc",function(){this.odooRpc={odoo_server:"",uniq_id_counter:0,context:{lang:"fr_FR"},shouldManageSessionId:!1,errorInterceptors:[]};var e=null;this.$get=["$http","$q","$timeout",function(n,s,o){var r=this.odooRpc;return r.login=function(e,n,o){var i={db:e,login:n,password:o};return r.sendRequest("/web/session/authenticate",i).then(function(e){return e.uid?(r.context=e.user_context,t.set_sessionId(e.session_id),e):(t.delete_sessionId(),s.reject({title:"wrong_login",message:"Credentials incorrect",fullTrace:e}))})},r.isLoggedIn=function(e){return e?r.getSessionInfo().then(function(e){return t.set_sessionId(e.session_id),!!e.uid}):t.get_sessionId().length>0},r.logout=function(e){t.delete_sessionId(),e&&r.getSessionInfo().then(function(e){e.db&&r.login(e.db,"","")})},r.searchRead=function(e,t,n){var s={model:e,domain:t,fields:n};return r.sendRequest("/web/dataset/search_read",s)},r.getSessionInfo=function(){return r.sendRequest("/web/session/get_session_info",{})},r.getServerInfo=function(){return r.sendRequest("/web/webclient/version_info",{})},r.getDbList=function(){return r.sendRequest("/web/database/get_list",{})},r.syncDataImport=function(e,t,n,s,o,i){return r.call(e,"get_sync_data",[t,i.timekey,n,s,o],{}).then(function(a){return i.timekey=a.timekey,angular.forEach(a.remove_ids,function(e){delete i.data[e]}),Object.keys(a.data).length?(angular.extend(i.data,a.data),r.syncDataImport(e,t,n,s,o,i)):void 0})},r.syncImportObject=function(e){function t(){r.syncDataImport(e.model,e.func_key,e.base_domain,e.filter_domain,e.limit,i).then(function(){n||o(t,e.interval)}).then(function(){s.forEach(function(e){e(i)})})}var n=!1,s=[],i={data:{},timekey:null,stopCallback:function(){n=!0},watch:function(e){s.push(e)}};return t(),i},r.call=function(e,t,n,s){s=s||{},s.context=s.context||{},angular.extend(s.context,r.context);var o={model:e,method:t,args:n,kwargs:s};return r.sendRequest("/web/dataset/call_kw",o)},r.sendRequest=function(o,i){function a(e,n){r.uniq_id_counter+=1,r.shouldManageSessionId&&(n.session_id=t.get_sessionId());var s={jsonrpc:"2.0",method:"call",params:n};return{method:"POST",url:r.odoo_server+e,data:JSON.stringify(s),headers:{"Content-Type":"application/json"},id:"r"+r.uniq_id_counter}}function u(e){if(!e.data.error)return e.data;var n=e.data.error,o={title:"",message:"",fullTrace:n};if(200===n.code&&"Odoo Server Error"===n.message&&"werkzeug.exceptions.NotFound"===n.data.name)o.title="page_not_found",o.message="HTTP Error";else if(100===n.code&&"Odoo Session Expired"===n.message||300===n.code&&"OpenERP WebClient Error"===n.message&&n.data.debug.match("SessionExpiredException"))o.title="session_expired",t.delete_sessionId();else if("Odoo Server Error"===n.message&&/FATAL:  database "(.+)" does not exist/.test(n.data.message))o.title="database_not_found",o.message=n.data.message;else if("openerp.exceptions.AccessError"===n.data.name)o.title="AccessError",o.message=n.data.message;else{var i=(""+n.data.fault_code).split("\n")[0].split(" -- ");i.length>1&&(n.type=i.shift(),n.data.fault_code=n.data.fault_code.substr(n.type.length+4)),200===n.code&&n.type?(o.title=n.type,o.message=n.data.fault_code.replace(/\n/g,"<br />")):(o.title=n.message,o.message=n.data.debug.replace(/\n/g,"<br />"))}return r.errorInterceptors.forEach(function(e){e(o)}),s.reject(o)}function d(e){var t={title:"http",fullTrace:e,message:"HTTP Error"};return r.errorInterceptors.forEach(function(e){e(t)}),s.reject(t)}function c(e,t){var s=a(e,t);return n(s).then(u,d)}function l(){return e||c("/web/webclient/version_info",{}).then(function(t){r.shouldManageSessionId=t.result.server_serie<"8",e=s.when()})}return l().then(function(){return c(o,i).then(function(e){var t=[];return"ir.actions.act_proxy"===e.result.type?(angular.forEach(e.result.action_list,function(e){t.push(n.post(e.url,e.params))}),s.all(t)):e.result})})},r}];var t=function(){var e;return{delete_sessionId:function(){e=null,document.cookie="session_id=; expires=Thu, 01 Jan 1970 00:00:00 GMT"},get_sessionId:function(){return document.cookie.split("; ").filter(function(e){return 0===e.indexOf("session_id")}).map(function(e){return e.split("=")[1]}).pop()||e||""},set_sessionId:function(t){document.cookie="session_id="+t,e=t}}}()});